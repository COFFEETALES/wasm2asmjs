on:
  workflow_call:

jobs:
  build:
    name: "Build ğŸ› ï¸"
    runs-on: ubuntu-latest
    container:
      image: node:24-alpine
    steps:
      - name: "Checkout repo âœ…"
        uses: actions/checkout@v4

      - name: "Install tools ğŸ“¦"
        run: |
          #apk update
          apk add --no-cache nodejs openjdk21-jre yarn
          node --version
          yarn install
          mkdir dist_artifacts
          mkdir test_artifacts

      - name: "Build project ğŸ”§"
        working-directory: dist_artifacts
        run: |
          yarn run closure-make
          node -e 'require("./wasm2lang.js").runCliEntryPoint()' - --input-file ../sample.wast

      - name: "Build tests ğŸ§ª"
        working-directory: test_artifacts
        run: |
          ../scripts/wasm2lang_build_tests.sh

      - name: "Upload artifacts-tests artifact ğŸ§°"
        uses: actions/upload-artifact@v4
        with:
          name: artifacts-tests
          path: ./test_artifacts
          if-no-files-found: error